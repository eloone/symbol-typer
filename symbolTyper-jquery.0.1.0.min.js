!function(){function a(a){throw new Error("symbolTyper stopped : "+a)}function b(a,b,d){return this.validateRequiredKeys(a,d),a.key=d,a.pattern=this.getPattern(a.replaced,b),this.validateOptionalKeys(a,d),a.htmlSymbol=h.convertToHtml(a.unicode),a.encoded=encodeURIComponent(h.htmlTrim(a.htmlSymbol)),a.before=c(a.before,b),a.after=c(a.after,b),a.inserted=a.before+a.htmlSymbol+a.after,a.textInserted=h.convertToText(a.inserted),a}function c(a,b){if(!a)return"";if(h.isContentEditable(b)){var c=a.replace(/^\s+|\s+$/g,"&nbsp;");return h.convertToHtml(c)}return a}function d(a,b){var c,d,e=a,f=new Caret,g=b;this.node=a,this.insertSymbols=function(){var a=this.getValue();for(var b in g){var e=g[b];if(a=this.insertSymbol(a,e),e.matched){c=e.textInserted.length-e.typed.length,d=e.typed,this.setValue(a);break}}},this.insertSymbol=function(a,b){var c=a,d=(h.convertToText(a),"([^\\\\]|^)("+b.pattern+")"),e=new RegExp(d),f=e.exec(c);if(b.typed="",f&&(b.typed=h.convertToText(f[2])),b.matched=!1,"number"==typeof b.limit)for(var g=this.getSymbolCount(b);g.unreplacedCount>0&&g.symbolCount<b.limit;)c=c.replace(e,"$1"+b.inserted),g=this.getSymbolCount(b,c),b.matched=!0;else b.matched=e.test(c),c=c.replace(e,"$1"+b.inserted);return c},this.getSymbolCount=function(a,b){var c={},d=h.convertToText(b||this.getValue()),e=encodeURIComponent(d),f="\\\\"+h.convertToText(a.pattern),g=new RegExp(f,"g");return c.symbolCount=h.getCountChar(a.encoded,e),c.unreplacedCount=h.getCountChar(a.replaced,d.replace(g,"")),c.symbol=a.key,c},this.getStatus=function(){var a=this.getValue(),b={count:{}},c=encodeURIComponent(a),d="";for(var e in g){var f=g[e],i="("+f.encoded+")",j="(\\\\)("+f.pattern+")",k=new RegExp(j,"g"),l=new RegExp(i,"g");b.count[e]=h.getCountChar(f.encoded,c),c=c.replace(l,""),d=h.htmlTrim(decodeURIComponent(c)),d=d.replace(k,"$2"),c=encodeURIComponent(d)}return b.rawText=h.convertToText(d),b.fullText=h.convertToText(a),b.targetId=this.node.id,b},this.setValue=function(a){var b=f.getPosition(e),g=b.textContainer.indexOf(d),h=b.value>g?b.value+c:b.value;this.isContentEditable?e.innerHTML=a:e.value=a,f.setPosition(h,b.path)},this.getValue=function(){return this.isContentEditable?e.innerHTML:e.value},this.isContentEditable=h.isContentEditable(e)}function e(a,c,e){function f(a){g(a),a.addEventListener&&(a.addEventListener("keyup",j),a.addEventListener("keydown",i)),a.attachEvent&&(m=!0,a.attachEvent("onkeyup",j),a.attachEvent("onkeydown",i))}function g(a){b.prototype.validateFormat(k.symbols);for(var c in k.symbols)k.symbols[c]=new b(k.symbols[c],a,c)}function i(a){for(var b=[13,39,37],c=!1,d=0;d<b.length;d++)if(b[d]==a.keyCode){c=!0;break}l=c||a.ctrlKey||a.metaKey}function j(a){try{if(l)return;var b=m?a.srcElement:a.target;if(b!==n.node&&(n=new d(b,k.symbols)),n.insertSymbols(),"function"==typeof k.onTyped){var c=n.getStatus();k.onTyped(c,a)}}catch(e){h.displayError(e)}}var k=this,l=!1,m=!1;k.symbols=h.clone(c),k.onTyped=e,f(a);var n=new d(a,k.symbols);this.getStatus=function(){return n.getStatus()}}function f(a,b,c){try{var d=[];h.IEFix(),h.browserIsSupported()===!1&&h.throwError("This browser is not supported. This script only supports HTML5 browsers and Internet Explorer 9 and above."),"undefined"==typeof a&&h.throwError("Argument 1 is missing. It must be an HTML Element or a collection (array or NodeList) of HTML elements."),"object"!=typeof b&&h.throwError('Argument 2 is missing. It should be an object of symbols like {hearts : {unicode : "&#xf0e7;", replaced: "*"}}.'),"undefined"==typeof a.length?d.push(a):d=a;var f={},g=0;do h.checkHtmlElt(d[g],g),d[g].id=d[g].id||"symbol_typer_"+g,f[d[g].id]=new e(d[g],b,c),g++;while(g<d.length);if(1==g)for(var i in f)f[i][i]=f[i],f=f[i];return f}catch(j){h.displayError(j)}}var g=document.createElement("p"),h=(document.createElement("input"),{checkHtmlElt:function(b,c){b&&1===b.nodeType||a("Input "+c+" : "+b+" is not an HTML Element. \nsymbolTyper works with an HTML element or a collection (array or NodeList) of HTML elements.")},isContentEditable:function(a){return"INPUT"==a.tagName||"TEXTAREA"==a.tagName?!1:!0},getCountChar:function i(a,b){if("function"==typeof a.push){for(var c=0,d=0;d<a.length;d++)c+=i(a[d],b);return c}return b.split(a).length-1},convertToHtml:function(a){return g.innerHTML=a,g.innerHTML},convertToText:function(a){return g.innerHTML=a,g.textContent},IEFix:function(){"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")})},browserIsSupported:function(){return"undefined"!=typeof g.textContent},htmlTrim:function(a){return a.replace(/^\s+|\s+$|&nbsp;/g,"")},throwError:a,displayError:function(a){console&&console.error&&console.error(a.message)},clone:function(a){var b={},c=!1;for(var d in a){b[d]={};for(var e in a[d])"undefined"!=typeof a[d][e]&&(c=!0,b[d][e]="function"==typeof a[d][e].slice?a[d][e].slice(0):a[d][e]);c||(b[d]=a[d])}return b}});b.prototype={validateRequiredKeys:function(a,b){"undefined"==typeof a.unicode&&h.throwError("The property {unicode} is missing from the {"+b+"} symbol object. It must be a String like &#173; (decimal) or &#xf007; (hexadecimal)."),"undefined"==typeof a.replaced&&h.throwError("The property {replaced} is missing from the {"+b+"} symbol object. It must be a String or an Array of strings.");var c=/^(&#x[a-fA-F0-9]+|&#\d+);$/;c.test(a.unicode)===!1&&h.throwError('This unicode format "'+a.unicode+'" is invalid. It must be like &#173; (decimal) or &#xf007; (hexadecimal).'),"string"!=typeof a.replaced&&"function"!=typeof a.replaced.push&&h.throwError("The {replaced} property in {"+b+"} symbol must be a String or an Array of strings.")},validateOptionalKeys:function(a,b){var c=new RegExp(a.pattern,"g");a.limit&&"number"!=typeof a.limit&&h.throwError("The property {limit} must be a number in the {"+b+"} symbol."),a.before&&c.test(a.before)&&h.throwError('{before} separator "'+a.before+'" in the {'+b+'} symbol must not contain a {replaced} string from "'+a.replaced+'"'),a.after&&c.test(a.after)&&h.throwError('{after} separator "'+a.after+'" in the {'+b+'} symbol must not contain a {replaced} string from "'+a.replaced+'"')},validateFormat:function(a){for(var b in a)"object"!=typeof a[b]&&h.throwError('The format of the symbols object must be like {hearts : {unicode : "&#173;", replaced : "<3"}}')},getPattern:function(a,b){var c=/[-[\]{}()*+?.,\\^$#\s]/g;if("function"==typeof a.push){for(var d=[],e=0;e<a.length;e++){var f=a[e];d.push(f.replace(c,"\\$&"))}d="("+d.join("|")+")"}else var d=a.replace(c,"\\$&");return h.isContentEditable(b)&&(d=h.convertToHtml(d)),d}},function(a){function b(){n="undefined"!=typeof(a.getSelection&&document.createRange),n===!1&&i("This browser is not supported. This script only supports HTML5 browsers and Internet Explorer 9 and above.")}function c(a){(!a||1!=a.nodeType&&3!=a.nodeType)&&i('The target "'+a+'" must be an HTML Element or Text node'),this.node=a}function d(){}function e(){this.target.node.focus();var b=a.getSelection().getRangeAt(0);return{value:b.endOffset,path:new k(this.target.node,b.endContainer),container:b.endContainer,textContainer:b.endContainer.nodeValue||""}}function f(){return this.target.node.focus(),{value:this.target.node.selectionStart,path:new k(this.target.node,this.target.node),container:this.target.node,textContainer:this.target.node.value||""}}function g(b){var c=this.target.node;this.target.isText()||(c=this.target.node.firstChild);var d=document.createRange();d.selectNodeContents(c),d.setEnd(c,b),d.collapse(!1),selection=a.getSelection(),selection.removeAllRanges(),selection.addRange(d)}function h(a){this.target.node.setSelectionRange(a,a)}function i(a){throw new Error("Caret : "+a)}function j(a){for(var b=a.getTree(),c=b.root,d=b.path,e=0;e<d.length;e++)c=c.childNodes[d[e]];return c}function k(a,b){var c=[];c=l(a,b,c),this.getTree=function(){return{root:a,path:c}}}function l(a,b,c){if(a===b||"undefined"==typeof b||"undefined"==typeof b.parentNode)return c;var d=m(b.parentNode,b);return c.unshift(d),l(a,b.parentNode,c)}function m(a,b){for(var c=0;c<a.childNodes.length;c++)if(a.childNodes[c]===b)return c}var n;a.addEventListener&&a.addEventListener("load",b),a.attachEvent&&a.attachEvent("onload",b),c.prototype={isContentEditable:function(){return 1==this.node.nodeType?!("INPUT"==this.node.tagName||"TEXTAREA"==this.node.tagName)&&"true"===this.node.getAttribute("contenteditable"):!1},isText:function(){return 3==this.node.nodeType}},d.prototype={getPosition:function(a){return this.target=new c(a),this.target.isText()&&i("Caret can get the caret's position only from editable HTML Elements. \""+this.target.node+'" is not editable.'),this.target.isContentEditable()?e.call(this):f.call(this)},setPosition:function(a,b){if(a&&!b&&i('Argument 2 "'+b+'" is invalid. It must be the HTML Element where to position the caret or a PositionPath.'),b instanceof k){var d=j(b);this.target=new c(d)}else this.target=new c(b);return this.target.isContentEditable()||this.target.isText()?g.call(this,a):h.call(this,a)}},a.Caret=d}(this),jQuery.fn.symbolTyper=function(a,b){var c=[];try{return this.each(function(){c.push(this)}),c[0]||h.throwError('No HTML element found for selector "'+this.selector+'"'),new f(c,a,b)}catch(d){h.displayError(d)}}}(this);